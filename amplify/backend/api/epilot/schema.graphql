type Guess
  @model
  @auth(
    rules: [
      {
        allow: owner
        ownerField: "owner"
        provider: userPools
        operations: [create, read, update, delete]
      }
    ]
  ) {
  id: ID!
  # Owner is auto-populated by Amplify auth resolvers on create
  owner: String @auth(rules: [{ allow: owner, operations: [read, delete] }])
  createdAt: AWSDateTime!
  settleAt: AWSDateTime!
  guessPrice: Float!
  startPrice: Float!
  endPrice: Float
  status: GuessStatus!
  result: GuessResult
}

type PriceSnapshot
  @model
  @auth(
    rules: [
      { allow: private, provider: userPools, operations: [read] }
      { allow: public, provider: apiKey, operations: [create, read, delete] }
    ]
  ) {
  id: ID!
  pk: String!
    @index(
      name: "byPkCapturedAt"
      queryField: "priceSnapshotsByPk"
      sortKeyFields: ["capturedAt"]
    )
  capturedAt: AWSDateTime!
  sourceUpdatedAt: AWSDateTime
  priceUsd: Float!
  source: String
}

type UserState
  @model
  @auth(
    rules: [
      {
        allow: owner
        ownerField: "owner"
        provider: userPools
        operations: [create, read, update, delete]
      }
      # apiKey needed for PostConfirmation Lambda to create UserState
      { allow: public, provider: apiKey, operations: [create] }
    ]
  ) {
  id: ID!
  owner: String!
    @auth(
      rules: [
        { allow: owner, operations: [read, delete] }
        # apiKey needs to set owner field during create (PostConfirmation Lambda)
        { allow: public, provider: apiKey, operations: [create] }
      ]
    )
  email: AWSEmail!
  username: String!
  score: Int!
  streak: Int!
  lastUpdatedAt: AWSDateTime!
}

enum GuessStatus {
  PENDING
  SETTLED
  FAILED
}

enum GuessResult {
  UP
  DOWN
  EQUAL
}
